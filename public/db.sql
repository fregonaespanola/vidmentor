USE VIDMENTOR;

DROP TABLE IF EXISTS ROL_INTERES;
DROP TABLE IF EXISTS TOKEN;
DROP TABLE IF EXISTS TIPO;
DROP TABLE IF EXISTS INTERES;
DROP TABLE IF EXISTS DETALLE;
DROP TABLE IF EXISTS USUARIO;
DROP TABLE IF EXISTS ROL;

CREATE TABLE ROL(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NOMBRE VARCHAR(50) NOT NULL UNIQUE,
	DESCRIPCION TEXT NOT NULL,
	PERMISOS TINYINT(1) DEFAULT '0'
);

CREATE TABLE USUARIO (
	ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	NICK VARCHAR(255) NOT NULL UNIQUE,
	NOMBRE VARCHAR(255) NOT NULL,
	MAIL VARCHAR(255) NOT NULL UNIQUE,
	PWD VARCHAR(255) DEFAULT NULL,
	F_REG DATETIME NOT NULL DEFAULT CURRENT_DATE,
	F_NAC DATE DEFAULT NULL,
	AVATAR VARCHAR(255) DEFAULT 'default.png',
	OAUTH VARCHAR(255) DEFAULT NULL,
	ROL_ID INT NOT NULL DEFAULT '2',
	INTERES VARCHAR(255) DEFAULT NULL,
	ACTIVADA TINYINT(1) DEFAULT '0',
	CONSTRAINT USUARIO_IBFK_1 FOREIGN KEY (ROL_ID) REFERENCES ROL(ID) ON DELETE CASCADE
);

CREATE TABLE DETALLE (
	ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	NOMBRE VARCHAR(255) NOT NULL,
	DESCRIPCION TEXT,
	FECHA DATE DEFAULT NULL,
	MINIATURA VARCHAR(255) DEFAULT 'default.png',
	ID_USUARIO INT NOT NULL,
	GANCHO TEXT,
	INTRO TEXT,
	ENGAGE1 TEXT,
	SETUP TEXT,
	ENGAGE2 TEXT,
	ENGAGE3 TEXT,
	CLIMAX TEXT,
	BAJADA TEXT,
	DESENLACE TEXT,
	IG_STORIES TINYINT(1) DEFAULT '0',
	REEL_CLIPS TINYINT(1) DEFAULT '0',
	SHARE_SOCIAL_MEDIA TINYINT(1) DEFAULT '0',
	CHECK_COMMENTS TINYINT(1) DEFAULT '0',
	CHECK_CTR TINYINT(1) DEFAULT '0',
	CHANGE_THUMBNAIL_2 TINYINT(1) DEFAULT '0',
	CHANGE_TITLE_2 TINYINT(1) DEFAULT '0',
	CHANGE_THUMBNAIL_3 TINYINT(1) DEFAULT '0',
	CHANGE_TITLE_3 TINYINT(1) DEFAULT '0',
	CHANGE_THUMBNAIL_4 TINYINT(1) DEFAULT '0',
	CHANGE_TITLE_4 TINYINT(1) DEFAULT '0',
	CONSTRAINT DETALLE_IBFK_1 FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID) ON DELETE CASCADE
);

CREATE TABLE INTERES(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NOMBRE VARCHAR(255) NOT NULL UNIQUE,
	DESCRIPCION TEXT NOT NULL
);

CREATE TABLE TIPO(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	NOMBRE VARCHAR(50) NOT NULL UNIQUE,
	DESCRIPCION TEXT NOT NULL
);

CREATE TABLE TOKEN(
	ID INT AUTO_INCREMENT PRIMARY KEY,
	TOKEN VARCHAR(255) NOT NULL,
	F_CRE DATETIME NOT NULL DEFAULT CURRENT_DATE,
	F_EXP DATETIME NOT NULL,
	ID_TIPO INT NOT NULL,
	ID_USUARIO INT NOT NULL,
	CONSTRAINT TOKEN_IBFK_1 FOREIGN KEY (ID_TIPO) REFERENCES TIPO(ID) ON DELETE CASCADE,
	CONSTRAINT TOKEN_IBFK_2 FOREIGN KEY (ID_USUARIO) REFERENCES USUARIO(ID) ON DELETE CASCADE
);

CREATE TABLE ROL_INTERES(
	ID INT NOT NULL AUTO_INCREMENT PRIMARY KEY,
	ID_ROL INT NOT NULL,
	ID_INTERES INT NOT NULL,
	CONSTRAINT ROL_INTERES_IBFK_1 FOREIGN KEY (ID_ROL) REFERENCES ROL(ID) ON DELETE CASCADE,
	CONSTRAINT ROL_INTERES_IBFK_2 FOREIGN KEY (ID_INTERES) REFERENCES INTERES(ID) ON DELETE CASCADE
);

INSERT INTO ROL(NOMBRE, DESCRIPCION, PERMISOS) VALUES('ADMIN', 'Administrador', 1);
INSERT INTO ROL(NOMBRE, DESCRIPCION) VALUES('USUARIO', 'Usuario');
INSERT INTO ROL(NOMBRE, DESCRIPCION) VALUES('EMPRESA', 'Empresa');
INSERT INTO USUARIO (NOMBRE, NICK, MAIL, PWD, ROL_ID, ACTIVADA) VALUES('ELPUTOAMO','admin', 'admin@admin.dev', 'admin', 1, 1);
INSERT INTO USUARIO (NOMBRE, NICK, MAIL, PWD, ROL_ID, ACTIVADA) VALUES('usuario', 'usuario','usuario@usuario.dev', 'usuario', 2, 1);
INSERT INTO USUARIO (NOMBRE, NICK, MAIL, PWD, ROL_ID, ACTIVADA) VALUES('usuario2', 'usuario2', 'usuario2@usuario.dev', 'usuario', 2, 0);
INSERT INTO TIPO(NOMBRE, DESCRIPCION) VALUES('RECUPERAR', 'Token para recuperar contrase√±a');
INSERT INTO TIPO(NOMBRE, DESCRIPCION) VALUES('ACTIVAR', 'Token para activar cuenta');
INSERT INTO TIPO(NOMBRE, DESCRIPCION) VALUES('RECORDAR', 'Token para recordar cuenta');
